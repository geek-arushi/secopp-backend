<!DOCTYPE html>
<html lang="en">

<head>
    <%- include("./partials/header.ejs") %>

        <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
        <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/quill-image-uploader@1.2.3/dist/quill.imageUploader.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

    <!-- ======= Header ======= -->
    <%- include("./partials/nav-header.ejs") %>
        <!-- End Header -->

        <!-- ======= Sidebar ======= -->
        <%- include("./partials/admin-sidebar.ejs") %>
            <!-- End Sidebar-->

            <main id="main" class="main">
                <%- include("./partials/flashMessage.ejs") %>
                    <div class="pagetitle">
                        <h1>Create New Blog</h1>
                        <nav>
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="">Home</a></li>
                                <li class="breadcrumb-item active">Create Blog</li>
                            </ol>
                        </nav>
                    </div><!-- End Page Title -->

                    <section class="section">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title fw-bold">Create New Blog</h5>
                                        <!-- Blog Form -->

                                        <form action="/admin/create-blog" method="POST" enctype="multipart/form-data" id="blogForm"
                                            class="row g-3 needs-validation">
                                            <h2 class="text-primary">Adding Data for blog Card*</h2>

                                            <div class="col-md-6">
                                                <label for="blogCardTitle" class="form-label fw-semibold">Blog Card
                                                    Title :</label>
                                                <input type="text" class="form-control" id="blogCardTitle"
                                                    name="blogCardTitle" required />
                                            </div>

                                            <div class="col-md-6">
                                                <label for="blogCardDescription" class="form-label fw-semibold">Blog Card
                                                    Description :</label>
                                                <input type="text" class="form-control" id="blogCardDescription"
                                                    name="blogCardDescription" required />
                                            </div>

                                            <div class="col-md-6">
                                                <label for="blogCategory" class="form-label fw-semibold">Blog Category
                                                    :</label>
                                                <select id="blogCategory" class="form-select" name="blogCategory"
                                                    required>
                                                    <option>Select Blog Category</option>
                                                    <option value="Cancer">Cancer</option>
                                                    <option value="Orthopedic">Orthopedics</option>
                                                </select>
                                            </div>

                                            <div class="col-md-6">
                                                <label for="blogCardImage" class="form-label fw-semibold">Blog Card Image
                                                    :</label>
                                                <input class="form-control" type="file" name="blogCardImage" id="blogCardImage" required>
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label text-primary h2">Write your blog</label>
                                                <div id="editor" style="height: 500px;"></div>
                                                <input type="hidden" name="content" id="hiddenContent" />
                                            </div>

                                            <button type="submit" class="btn btn-success">Publish Blog</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

            </main>
            <!-- End #main -->

            <!-- ======= Footer ======= -->
            <%- include('./partials/footer.ejs') %>

                <script>
                    Quill.register("modules/imageUploader", window.ImageUploader);

                    const quill = new Quill("#editor", {
                        theme: "snow",
                        modules: {
                            toolbar: [
                                [{ header: [1, 2, 3, 4, 5, 6, false] }],
                                ["bold", "italic", "underline"],
                                ["link", "image"],
                                [{ list: "ordered" }, { list: "bullet" }],
                                ["clean"]
                            ],
                            imageUploader: {
                                upload: file => {
                                    return new Promise((resolve, reject) => {
                                        const formData = new FormData();
                                        formData.append("file", file);
                                        formData.append("upload_preset", "Preset_1"); // Change
                                        fetch("https://api.cloudinary.com/v1_1/dwxpjipx6/image/upload", {
                                            method: "POST",
                                            body: formData
                                        })
                                            .then(res => res.json())
                                            .then(res => {
                                                resolve(res.secure_url); // Quill will insert this URL into the editor
                                            })
                                            .catch(() => {
                                                reject("Image upload failed");
                                            });
                                    });
                                }
                            }
                        }
                    });

                    document.getElementById("blogForm").addEventListener("submit", function (e) {
                        const html = quill.root.innerHTML;
                        document.getElementById("hiddenContent").value = html;
                    });
                </script>
</body>

</html>